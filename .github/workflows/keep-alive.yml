name: Manter Projeto Supabase Ativo

on:
  schedule:
    # MUDAN√áA 1: Cron di√°rio (08:00 UTC) para garantir atividade a cada 24h
    - cron: '0 8 * * *'
  workflow_dispatch:

jobs:
  ping-db:
    runs-on: ubuntu-latest
    steps:
      - name: Configurar Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: '22' # ATUALIZADO: Usando Node v22

      - name: Instalar depend√™ncia
        run: npm install @supabase/supabase-js

      - name: Executar Ping
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }} 
        run: |
          node --input-type=module -e "
            import { createClient } from '@supabase/supabase-js';

            const url = process.env.SUPABASE_URL;
            const key = process.env.SUPABASE_KEY;

            if (!url || !key) {
              console.error('‚ùå Erro: Secrets SUPABASE_URL ou SUPABASE_KEY n√£o encontradas.');
              process.exit(1);
            }

            const supabase = createClient(url, key);

            async function ping() {
              console.log('üì° Iniciando ping di√°rio no Supabase...');
              
              // MUDAN√áA 2: Select real de 1 linha.
              // 'head: true' muitas vezes n√£o conta como atividade de banco.
              const { data, error } = await supabase
                .from('satisfaction_forms')
                .select('id')
                .limit(1);

              if (error) {
                console.error('‚ùå Erro de conex√£o:', error.message);
                process.exit(1);
              }

              console.log('‚úÖ Sucesso! O banco respondeu e a inatividade foi resetada.');
            }

            ping();
          "
