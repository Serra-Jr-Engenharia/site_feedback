name: Manter Projeto Supabase Ativo

on:
  schedule:
    - cron: '0 8 * * *' # Roda TODO DIA √†s 08:00 UTC
  workflow_dispatch:

jobs:
  ping-db:
    runs-on: ubuntu-latest
    steps:
      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Instalar depend√™ncia
        run: npm install @supabase/supabase-js

      - name: Executar Ping
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          # RECOMENDADO: Use a Service Role Key para garantir acesso
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }} 
        run: |
          node --input-type=module -e "
            import { createClient } from '@supabase/supabase-js';

            const url = process.env.SUPABASE_URL;
            const key = process.env.SUPABASE_KEY;

            if (!url || !key) {
              console.error('‚ùå Faltam vari√°veis de ambiente.');
              process.exit(1);
            }

            const supabase = createClient(url, key);

            async function ping() {
              console.log('üì° Iniciando ping no Supabase...');
              
              // REMOVIDO: head: true
              // ADICIONADO: limit(1) para for√ßar leitura de dados
              const { data, error } = await supabase
                .from('satisfaction_forms')
                .select('id')
                .limit(1);

              if (error) {
                console.error('‚ùå Erro no Supabase:', error.message);
                process.exit(1);
              }

              console.log('‚úÖ Sucesso! Dados recebidos:', data);
            }

            ping();
          "
